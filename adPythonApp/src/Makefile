TOP=../..

include $(TOP)/configure/CONFIG

# -------------------------------
# Build an Diamond Support Module
# -------------------------------

# This tells the compiler to ignore errors generated by EPICS includes.  We need
# this because the EPICS headers have non strict prototypes in places.
ifdef OS_CLASS
ifneq ($(OS_CLASS), WIN32)
USR_CPPFLAGS += -isystem $(EPICS_BASE)/include
endif
endif

# Nice and strict...
USR_CXXFLAGS += -Wall
ifdef OS_CLASS
ifneq ($(OS_CLASS), WIN32)
USR_CXXFLAGS += -Werror
USR_CXXFLAGS += -Wextra
USR_CXXFLAGS += -Wno-unused-parameter
USR_CXXFLAGS += -Wno-missing-field-initializers
USR_CXXFLAGS += -Wundef
USR_CXXFLAGS += -Wshadow
USR_CXXFLAGS += -Wcast-align
USR_CXXFLAGS += -Wwrite-strings
USR_CXXFLAGS += -Wredundant-decls
USR_CXXFLAGS += -Wmissing-declarations
endif
endif

LIBRARY_IOC += adPython

# xxxRecord.dbd will be installed into <top>/dbd
DBD += adPythonPlugin.dbd

# The following are compiled and added to the support library
adPython_SRCS += adPythonPlugin.cpp

# link against python
ifneq ($(PYTHON_PREFIX),)
    # user defined prefix, add it explicitly
	USR_INCLUDES += -I$(PYTHON_INCLUDE)
	USR_INCLUDES += -I$(NUMPY_INCLUDE)
	python$(PYTHON_VERSION)_DIR = $(PYTHON_LIB)
	LIB_LIBS += python$(PYTHON_VERSION)
else
    # it's in a standard place
	LIB_SYS_LIBS += python$(PYTHON_VERSION)
endif

# add more libs
LIB_LIBS += NDPlugin

# location of plugin scripts
USR_CXXFLAGS += -DDATADIRS=\"$(ADPYTHON_MODULE_PATH)\"

# install plugin scripts
PLUGINSCRIPTS += adPythonOffline.py
PLUGINSCRIPTS += adPythonPlugin.py

include $(TOP)/configure/RULES
